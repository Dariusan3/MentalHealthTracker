@page "/statistici"
@using MentalHealthTracker.Models
@using System.Net.Http.Json
@using Microsoft.AspNetCore.Authorization
@using Microsoft.AspNetCore.Components.Authorization
@using System.Security.Claims
@inject HttpClient Http
@inject IJSRuntime JSRuntime
@inject NavigationManager NavigationManager
@inject AuthenticationStateProvider AuthStateProvider
@attribute [Authorize]

<PageTitle>Mental Health Tracker - Statistics</PageTitle>

<MudContainer MaxWidth="MaxWidth.Large" Class="mt-4">
    <MudText Typo="Typo.h3" Class="mb-4">Mood Statistics</MudText>

    @if (isLoading)
    {
        <div class="d-flex flex-column align-center my-8">
            <MudProgressCircular Color="Color.Primary" Size="Size.Large" Indeterminate="true" />
            <MudText Class="mt-4">Loading statistics...</MudText>
        </div>
    }
    else if (!string.IsNullOrEmpty(errorMessage))
    {
        <MudPaper Class="pa-4 my-4" Elevation="3">
            <MudAlert Severity="Severity.Error" Variant="Variant.Filled" Class="mb-3">
                @errorMessage
            </MudAlert>
            <MudButton Variant="Variant.Filled" Color="Color.Primary" OnClick="ReloadStatistics">
                Retry
            </MudButton>
        </MudPaper>
    }
    else if (statistics == null || statistics.EntriesCount == 0)
    {
        <MudPaper Class="pa-4 my-4" Elevation="3">
            <MudAlert Severity="Severity.Info" Variant="Variant.Filled" Class="mb-3">
                Not enough data to generate statistics. Add more entries to your journal.
            </MudAlert>
            <MudButton Variant="Variant.Filled" Color="Color.Primary" Href="/adauga-intrare">
                Add an entry
            </MudButton>
        </MudPaper>
    }
    else
    {
        <MudGrid>
            <MudItem xs="12" md="6">
                <MudPaper Class="pa-4" Elevation="3">
                    <MudText Typo="Typo.h5">Summary</MudText>
                    <MudDivider Class="my-2" />
                    <MudList>
                        <MudListItem Icon="@Icons.Material.Filled.Mood">
                            Average mood: <b>@FormatDouble(statistics.AverageMood)</b> / 10
                        </MudListItem>
                        <MudListItem Icon="@Icons.Material.Filled.CalendarToday">
                            Total entries: <b>@statistics.EntriesCount</b>
                        </MudListItem>
                        <MudListItem Icon="@Icons.Material.Filled.Bedtime">
                            Average sleep hours: <b>@FormatDouble(statistics.AverageSleepHours)</b> hours
                        </MudListItem>
                    </MudList>
                </MudPaper>
            </MudItem>
            
            <MudItem xs="12" md="6">
                <MudPaper Class="pa-4" Elevation="3">
                    <MudText Typo="Typo.h5">Frequent Activities</MudText>
                    <MudDivider Class="my-2" />
                    @if (statistics.MostCommonActivities != null && statistics.MostCommonActivities.Any())
                    {
                        <MudList>
                            @foreach (var activity in statistics.MostCommonActivities)
                            {
                                <MudListItem Icon="@Icons.Material.Filled.CheckCircle">
                                    @activity
                                </MudListItem>
                            }
                        </MudList>
                    }
                    else
                    {
                        <MudText>No activities recorded.</MudText>
                    }
                </MudPaper>
            </MudItem>
            
            <MudItem xs="12" md="6">
                <MudPaper Class="pa-4" Elevation="3">
                    <MudText Typo="Typo.h5">Common Triggers</MudText>
                    <MudDivider Class="my-2" />
                    @if (statistics.MostCommonTriggers != null && statistics.MostCommonTriggers.Any())
                    {
                        <MudList>
                            @foreach (var trigger in statistics.MostCommonTriggers)
                            {
                                <MudListItem Icon="@Icons.Material.Filled.Warning">
                                    @trigger
                                </MudListItem>
                            }
                        </MudList>
                    }
                    else
                    {
                        <MudText>No triggers recorded.</MudText>
                    }
                </MudPaper>
            </MudItem>
            
            <MudItem xs="12" md="6">
                <MudPaper Class="pa-4" Elevation="3">
                    <MudText Typo="Typo.h5">Overall Assessment</MudText>
                    <MudDivider Class="my-2" />
                    
                    @{
                        var moodDesc = GetMoodDescription(statistics.AverageMood);
                        var moodColor = GetMoodColor(statistics.AverageMood);
                    }
                    
                    <div class="d-flex align-center my-4">
                        <MudIcon Icon="@GetMoodIcon(statistics.AverageMood)" 
                                Color="@moodColor" 
                                Size="Size.Large" 
                                Class="mr-3" />
                        <MudText Typo="Typo.h6" Color="@moodColor">@moodDesc</MudText>
                    </div>
                    
                    <MudText Typo="Typo.body1" Class="my-2">
                        @GetRecommendation(statistics.AverageMood)
                    </MudText>
                </MudPaper>
            </MudItem>
            
            <MudItem xs="12">
                <MudPaper Class="pa-4" Elevation="3">
                    <div class="d-flex justify-space-between align-center">
                        <MudText Typo="Typo.h5">Mood Trend</MudText>
                        
                        @if (statistics.MoodTrend != null && statistics.MoodTrend.Any())
                        {
                            <MudButton Variant="Variant.Text" 
                                      Color="Color.Primary"
                                      OnClick="RegenerateChart"
                                      StartIcon="@Icons.Material.Filled.Refresh">
                                Reload chart
                            </MudButton>
                        }
                    </div>
                    <MudDivider Class="my-2" />
                    
                    @if (statistics.MoodTrend != null && statistics.MoodTrend.Any())
                    {
                        <div id="moodTrendChart" style="height: 350px;"></div>
                        <MudText Typo="Typo.caption" Class="mt-2">
                            * Chart shows mood trends over the last 30 days
                        </MudText>
                    }
                    else
                    {
                        <MudAlert Severity="Severity.Info" Class="mt-3">
                            Not enough data to generate the trend chart.
                        </MudAlert>
                    }
                </MudPaper>
            </MudItem>
        </MudGrid>
    }
</MudContainer>

@code {
    private StatisticsViewModel? statistics;
    private string? errorMessage;
    private bool isLoading = true;
    private bool chartInitialized = false;

    protected override async Task OnInitializedAsync()
    {
        var authState = await AuthStateProvider.GetAuthenticationStateAsync();
        var isAuthenticated = authState.User.Identity?.IsAuthenticated ?? false;
        var userName = authState.User.Identity?.Name ?? "unknown";
        var userId = authState.User.FindFirst(ClaimTypes.NameIdentifier)?.Value ?? "unknown";
        
        Console.WriteLine($"Statistics.razor - OnInitializedAsync: Authenticated: {isAuthenticated}, User: {userName}, ID: {userId}");
        
        await LoadStatistics();
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            Console.WriteLine("Statistics.razor - OnAfterRenderAsync: First render");
            await InitializeChartScript();
        }
        
        if (statistics != null && statistics.MoodTrend != null && statistics.MoodTrend.Any() && !chartInitialized)
        {
            Console.WriteLine("Statistics.razor - OnAfterRenderAsync: Generating chart");
            await GenerateCharts();
            chartInitialized = true;
        }
    }
    
    private async Task InitializeChartScript()
    {
        try
        {
            Console.WriteLine("Statistics.razor - InitializeChartScript: Loading Chart.js");
            
            var chartJsLoaded = await JSRuntime.InvokeAsync<bool>("eval", "typeof Chart !== 'undefined'");
            
            if (!chartJsLoaded)
            {
                Console.WriteLine("Statistics.razor - InitializeChartScript: Chart.js not loaded, loading it now");
                
                await JSRuntime.InvokeVoidAsync("eval", @"
                    const script = document.createElement('script');
                    script.src = 'https://cdn.jsdelivr.net/npm/chart.js';
                    document.head.appendChild(script);
                ");
            }
            
            Console.WriteLine("Statistics.razor - InitializeChartScript: Chart.js loaded successfully");
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Statistics.razor - InitializeChartScript: Error loading Chart.js: {ex.Message}");
        }
    }

    private async Task LoadStatistics()
    {
        try
        {
            isLoading = true;
            errorMessage = null;
            statistics = null;
            
            var authState = await AuthStateProvider.GetAuthenticationStateAsync();
            var isAuthenticated = authState.User.Identity?.IsAuthenticated ?? false;
            var userId = authState.User.FindFirst(ClaimTypes.NameIdentifier)?.Value;
            
            if (!isAuthenticated || string.IsNullOrEmpty(userId))
            {
                errorMessage = "You are not signed in. Please sign in to view statistics.";
                Console.WriteLine("Statistics.razor - LoadStatistics: User not authenticated!");
                NavigationManager.NavigateTo("/Identity/Account/Login", true);
                return;
            }
            
            Console.WriteLine($"Statistics.razor - LoadStatistics: Authenticated user with ID {userId}");
            
            await LoadEntriesAndCalculateStatistics(userId);
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Statistics.razor - LoadStatistics: General error: {ex.Message}");
            Console.WriteLine($"Statistics.razor - LoadStatistics: StackTrace: {ex.StackTrace}");
            errorMessage = $"Error: {ex.Message}";
        }
        finally
        {
            isLoading = false;
            StateHasChanged();
        }
    }
    
    private async Task LoadEntriesAndCalculateStatistics(string userId)
    {
        try
        {
            Console.WriteLine("Statistics.razor - LoadEntriesAndCalculateStatistics: Loading all user entries...");
            
            var request = new HttpRequestMessage(HttpMethod.Get, $"api/MoodEntries?pageSize=1000&userId={userId}");
            request.Headers.Add("X-Test-Mode", "true");
            request.Headers.Add("X-Override-Auth", "true");
            request.Headers.Add("X-Requested-With", "XMLHttpRequest");
            request.Headers.Add("Cache-Control", "no-cache, no-store, must-revalidate");
            
            var response = await Http.SendAsync(request);
            
            if (response.IsSuccessStatusCode)
            {
                var content = await response.Content.ReadAsStringAsync();
                Console.WriteLine($"Statistics.razor - LoadEntriesAndCalculateStatistics: Received response with length {content.Length}");
                
                try
                {
                    var entries = System.Text.Json.JsonSerializer.Deserialize<List<MoodEntry>>(content, 
                        new System.Text.Json.JsonSerializerOptions { PropertyNameCaseInsensitive = true });
                    
                    if (entries != null && entries.Any())
                    {
                        Console.WriteLine($"Statistics.razor - LoadEntriesAndCalculateStatistics: Loaded {entries.Count} entries");
                        
                        foreach (var entry in entries.Take(3))
                        {
                            Console.WriteLine($"Entry: ID={entry.Id}, Date={entry.Date}, MoodLevel={entry.MoodLevel}");
                        }
                        
                        CalculateStatisticsFromEntries(entries);
                        chartInitialized = false;
                    }
                    else
                    {
                        Console.WriteLine("Statistics.razor - LoadEntriesAndCalculateStatistics: No valid entries received");
                        errorMessage = "No entries in database. Add some to see statistics.";
                    }
                }
                catch (Exception ex)
                {
                    Console.WriteLine($"Statistics.razor - LoadEntriesAndCalculateStatistics: Deserialization error: {ex.Message}");
                    errorMessage = $"Error processing data: {ex.Message}";
                    Console.WriteLine($"Partial content: {content.Substring(0, Math.Min(200, content.Length))}...");
                    await TryAlternativeStatisticsLoading(userId);
                }
            }
            else
            {
                var errorText = await response.Content.ReadAsStringAsync();
                Console.WriteLine($"Statistics.razor - LoadEntriesAndCalculateStatistics: HTTP Error: {response.StatusCode}, {errorText}");
                errorMessage = $"Error loading data: {response.StatusCode}";
                await TestApiConnection();
                await TryAlternativeStatisticsLoading(userId);
            }
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Statistics.razor - LoadEntriesAndCalculateStatistics: Exception: {ex.Message}");
            errorMessage = $"Error: {ex.Message}";
            await TestApiConnection();
            await TryAlternativeStatisticsLoading(userId);
        }
    }
    
    private void CalculateStatisticsFromEntries(List<MoodEntry> entries)
    {
        try
        {
            Console.WriteLine("Statistics.razor - CalculateStatisticsFromEntries: Calculating statistics from real data...");
            
            if (entries == null || !entries.Any())
            {
                Console.WriteLine("Statistics.razor - CalculateStatisticsFromEntries: No data to calculate");
                return;
            }

            var activeEntries = entries;
            
            if (!activeEntries.Any())
            {
                Console.WriteLine("Statistics.razor - CalculateStatisticsFromEntries: No active entries");
                return;
            }
            
            statistics = new StatisticsViewModel
            {
                EntriesCount = activeEntries.Count(),
                AverageMood = Math.Round(activeEntries.Average(e => e.MoodLevel), 1),
                AverageSleepHours = activeEntries.Any(e => e.SleepHours.HasValue) 
                    ? Math.Round(activeEntries.Where(e => e.SleepHours.HasValue).Average(e => e.SleepHours.GetValueOrDefault()), 1)
                    : 0,
                MoodTrend = new List<MoodTrendItem>(),
                MostCommonActivities = new List<string>(),
                MostCommonTriggers = new List<string>()
            };
            
            var last30Days = activeEntries
                .Where(e => e.Date >= DateTime.Today.AddDays(-30))
                .GroupBy(e => e.Date.Date)
                .Select(g => new MoodTrendItem
                {
                    Date = g.Key.ToString("yyyy-MM-dd"),
                    AverageMood = Math.Round(g.Average(e => e.MoodLevel), 1)
                })
                .OrderBy(m => m.Date)
                .ToList();
            
            statistics.MoodTrend = last30Days;
            
            Console.WriteLine($"Statistics.razor - CalculateStatisticsFromEntries: Mood trend - {last30Days.Count} days");
            
            var activities = activeEntries
                .Where(e => !string.IsNullOrEmpty(e.Activities))
                .SelectMany(e => e.Activities.Split(',', StringSplitOptions.RemoveEmptyEntries))
                .Where(a => !string.IsNullOrEmpty(a))
                .Select(a => a.Trim())
                .GroupBy(a => a)
                .OrderByDescending(g => g.Count())
                .Take(5)
                .Select(g => g.Key)
                .ToList();
            
            statistics.MostCommonActivities = activities;
            
            Console.WriteLine($"Statistics.razor - CalculateStatisticsFromEntries: Frequent activities - {activities.Count} activities");
            
            var triggers = activeEntries
                .Where(e => !string.IsNullOrEmpty(e.Triggers))
                .SelectMany(e => e.Triggers.Split(',', StringSplitOptions.RemoveEmptyEntries))
                .Where(t => !string.IsNullOrEmpty(t))
                .Select(t => t.Trim())
                .GroupBy(t => t)
                .OrderByDescending(g => g.Count())
                .Take(5)
                .Select(g => g.Key)
                .ToList();
            
            statistics.MostCommonTriggers = triggers;
            
            Console.WriteLine($"Statistics.razor - CalculateStatisticsFromEntries: Triggers - {triggers.Count} triggers");
            Console.WriteLine($"Statistics.razor - CalculateStatisticsFromEntries: Statistics calculated from real data: AverageMood={statistics.AverageMood}, EntriesCount={statistics.EntriesCount}");
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Statistics.razor - CalculateStatisticsFromEntries: Calculation error: {ex.Message}");
            errorMessage = $"Error calculating statistics: {ex.Message}";
        }
    }

    private void CreateDummyStatistics()
    {
        Console.WriteLine("Statistics.razor - CreateDummyStatistics: No mockup data will be created!");
    }

    private async Task TestApiConnection()
    {
        try
        {
            Console.WriteLine("Statistics.razor - TestApiConnection: Testing API connectivity...");
            var testUrl = "api/MoodEntries/test";
            var response = await Http.GetAsync(testUrl);
            
            Console.WriteLine($"Statistics.razor - TestApiConnection: Response: {response.StatusCode}");
            
            if (response.IsSuccessStatusCode)
            {
                var content = await response.Content.ReadAsStringAsync();
                Console.WriteLine($"Statistics.razor - TestApiConnection: Content: {content}");
            }
            else
            {
                Console.WriteLine("Statistics.razor - TestApiConnection: API not responding correctly");
            }
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Statistics.razor - TestApiConnection: Exception: {ex.Message}");
        }
    }
    
    private async Task TryAlternativeStatisticsLoading(string userId)
    {
        try
        {
            Console.WriteLine("Statistics.razor - TryAlternativeStatisticsLoading: Trying alternative method...");
            
            var request = new HttpRequestMessage(HttpMethod.Get, $"api/MoodEntries?userId={userId}&pageSize=500");
            request.Headers.Add("X-Test-Mode", "true");
            request.Headers.Add("X-Override-Auth", "true");
            request.Headers.Add("X-Requested-With", "XMLHttpRequest");
            request.Headers.Add("Cache-Control", "no-cache, no-store, must-revalidate");
            request.Headers.Add("X-Force-Load", "true");
            
            var response = await Http.SendAsync(request);
            
            if (response.IsSuccessStatusCode)
            {
                var content = await response.Content.ReadAsStringAsync();
                Console.WriteLine($"Statistics.razor - TryAlternativeStatisticsLoading: Received data, length: {content.Length}");
                
                try
                {
                    var entries = System.Text.Json.JsonSerializer.Deserialize<List<MoodEntry>>(content, 
                        new System.Text.Json.JsonSerializerOptions { PropertyNameCaseInsensitive = true });
                    
                    if (entries != null && entries.Any())
                    {
                        Console.WriteLine($"Statistics.razor - TryAlternativeStatisticsLoading: Received {entries.Count} entries");
                        CalculateStatisticsFromEntries(entries);
                    }
                    else
                    {
                        Console.WriteLine("Statistics.razor - TryAlternativeStatisticsLoading: No valid entries received");
                        errorMessage = "No data in database. Add some entries to see statistics.";
                    }
                }
                catch (Exception ex)
                {
                    Console.WriteLine($"Statistics.razor - TryAlternativeStatisticsLoading: Deserialization error: {ex.Message}");
                    errorMessage = $"Error processing data: {ex.Message}";
                    await TryStatisticsEndpoint();
                }
            }
            else
            {
                Console.WriteLine($"Statistics.razor - TryAlternativeStatisticsLoading: HTTP Error: {response.StatusCode}");
                errorMessage = $"Could not load data: {response.StatusCode}";
                await TryStatisticsEndpoint();
            }
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Statistics.razor - TryAlternativeStatisticsLoading: Exception: {ex.Message}");
            errorMessage = $"Error: {ex.Message}";
            await TryStatisticsEndpoint();
        }
    }
    
    private async Task TryStatisticsEndpoint()
    {
        try
        {
            Console.WriteLine("Statistics.razor - TryStatisticsEndpoint: Trying statistics endpoint...");
            
            var timestamp = DateTime.Now.Ticks;
            var url = $"api/MoodEntries/Statistics?_={timestamp}";
            
            var request = new HttpRequestMessage(HttpMethod.Get, url);
            request.Headers.Add("X-Requested-With", "XMLHttpRequest");
            request.Headers.Add("Cache-Control", "no-cache, no-store, must-revalidate");
            request.Headers.Add("X-Test-Mode", "true"); 
            request.Headers.Add("X-Override-Auth", "true");
            request.Headers.Add("X-Force-Load", "true");
            
            Console.WriteLine("Statistics.razor - TryStatisticsEndpoint: Sending HTTP request...");
            var response = await Http.SendAsync(request);
            
            Console.WriteLine($"Statistics.razor - TryStatisticsEndpoint: Response received: {response.StatusCode}");
            
            if (response.IsSuccessStatusCode)
            {
                var content = await response.Content.ReadAsStringAsync();
                Console.WriteLine($"Statistics.razor - TryStatisticsEndpoint: Content received: {content}");
                
                if (content.Contains("\"averageMood\":7.5") && content.Contains("\"entriesCount\":10"))
                {
                    Console.WriteLine("Statistics.razor - TryStatisticsEndpoint: Detected mockup data, will not use it");
                    errorMessage = "Server returned mockup data. Please add real entries to your journal.";
                    return;
                }
                
                try
                {
                    statistics = System.Text.Json.JsonSerializer.Deserialize<StatisticsViewModel>(content, 
                        new System.Text.Json.JsonSerializerOptions { PropertyNameCaseInsensitive = true });
                    
                    if (statistics != null && statistics.EntriesCount > 0)
                    {
                        Console.WriteLine("Statistics.razor - TryStatisticsEndpoint: Data deserialized successfully!");
                        Console.WriteLine($"Statistics.razor - TryStatisticsEndpoint: AverageMood = {statistics.AverageMood}, EntriesCount = {statistics.EntriesCount}");
                        chartInitialized = false;
                    }
                    else
                    {
                        Console.WriteLine("Statistics.razor - TryStatisticsEndpoint: No data or empty statistics");
                        errorMessage = "No data in database. Add some entries to see statistics.";
                    }
                }
                catch (Exception ex)
                {
                    Console.WriteLine($"Statistics.razor - TryStatisticsEndpoint: Deserialization error: {ex.Message}");
                    errorMessage = $"Error processing data: {ex.Message}";
                }
            }
            else
            {
                var errorContent = await response.Content.ReadAsStringAsync();
                Console.WriteLine($"Statistics.razor - TryStatisticsEndpoint: HTTP Error: Status {response.StatusCode}, Content: {errorContent}");
                errorMessage = $"Error loading statistics: {response.StatusCode}";
            }
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Statistics.razor - TryStatisticsEndpoint: Exception: {ex.Message}");
            errorMessage = $"Error: {ex.Message}";
        }
    }

    private async Task GenerateCharts()
    {
        try
        {
            if (statistics == null || statistics.MoodTrend == null || !statistics.MoodTrend.Any())
            {
                Console.WriteLine("Statistics.razor - GenerateCharts: No data for chart");
                return;
            }

            var labels = statistics.MoodTrend.Select(m => m.Date).ToArray();
            var data = statistics.MoodTrend.Select(m => m.AverageMood).ToArray();

            var elementExists = await JSRuntime.InvokeAsync<bool>("eval", "document.getElementById('moodTrendChart') !== null");
            Console.WriteLine($"Statistics.razor - GenerateCharts: Chart container check: {elementExists}");

            if (!elementExists)
            {
                Console.WriteLine("Statistics.razor - GenerateCharts: Chart container does not exist!");
                return;
            }

            await JSRuntime.InvokeVoidAsync("chartUtils.createMoodTrendChart", "moodTrendChart", labels, data);
            Console.WriteLine("Statistics.razor - GenerateCharts: Chart generated successfully");
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Statistics.razor - GenerateCharts: Error generating chart: {ex.Message}");
            
            try
            {
                await JSRuntime.InvokeVoidAsync("eval", @"
                    setTimeout(function() {
                        if (typeof chartUtils !== 'undefined' && chartUtils.createMoodTrendChart) {
                            console.log('Retrying chart generation after delay');
                            chartUtils.createMoodTrendChart('moodTrendChart', 
                                " + System.Text.Json.JsonSerializer.Serialize(statistics.MoodTrend.Select(m => m.Date)) + @", 
                                " + System.Text.Json.JsonSerializer.Serialize(statistics.MoodTrend.Select(m => m.AverageMood)) + @");
                        }
                    }, 1000);
                ");
            }
            catch (Exception innerEx)
            {
                Console.WriteLine($"Statistics.razor - GenerateCharts: Alternative method also failed: {innerEx.Message}");
            }
        }
    }
    
    private async Task RegenerateChart()
    {
        Console.WriteLine("Statistics.razor - RegenerateChart: Regenerating chart");
        chartInitialized = false;
        await GenerateCharts();
        chartInitialized = true;
    }
    
    private async Task ReloadStatistics()
    {
        Console.WriteLine("Statistics.razor - ReloadStatistics: Reloading statistics");
        chartInitialized = false;
        await LoadStatistics();
    }
    
    private string FormatDouble(double value)
    {
        return value.ToString("0.0");
    }
    
    private string GetMoodDescription(double moodLevel)
    {
        if (moodLevel <= 3) return "Negative mood";
        if (moodLevel <= 5) return "Low-neutral mood";
        if (moodLevel <= 7) return "High-neutral mood";
        return "Positive mood";
    }
    
    private MudBlazor.Color GetMoodColor(double moodLevel)
    {
        if (moodLevel <= 3) return MudBlazor.Color.Error;
        if (moodLevel <= 5) return MudBlazor.Color.Warning;
        if (moodLevel <= 7) return MudBlazor.Color.Info;
        return MudBlazor.Color.Success;
    }
    
    private string GetMoodIcon(double moodLevel)
    {
        if (moodLevel <= 3) return Icons.Material.Filled.SentimentVeryDissatisfied;
        if (moodLevel <= 5) return Icons.Material.Filled.SentimentDissatisfied;
        if (moodLevel <= 7) return Icons.Material.Filled.SentimentSatisfied;
        return Icons.Material.Filled.SentimentVerySatisfied;
    }
    
    private string GetRecommendation(double moodLevel)
    {
        if (moodLevel <= 3)
            return "Your mood level is low. Consider talking to a mental health professional and pay more attention to activities that bring you joy.";
        if (moodLevel <= 5)
            return "Your mood is below average. Try to include more pleasant activities in your daily schedule and pay attention to factors that negatively affect your mood.";
        if (moodLevel <= 7)
            return "Your mood is good. Continue to maintain balance between daily activities and pay attention to managing stress factors.";
        return "Your mood is excellent! Continue to maintain positive habits and share your joy with those around you.";
    }
}